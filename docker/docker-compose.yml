name: anythingllm

networks:
  anything-llm:
    driver: bridge

services:
  # ğŸ¯ Qdrantå‘é‡æ•°æ®åº“æœåŠ¡
  # æ— åŸç”Ÿä¾èµ–,é€šè¿‡HTTP APIè¿æ¥,å…¼å®¹æ‰€æœ‰CPUæ¶æ„
  qdrant:
    image: qdrant/qdrant:latest
    container_name: qdrant
    ports:
      - "6333:6333"  # HTTP API
      - "6334:6334"  # gRPC (å¯é€‰)
    volumes:
      - "../qdrant-data:/qdrant/storage"  # æ•°æ®æŒä¹…åŒ–
    environment:
      - QDRANT__LOG_LEVEL=INFO
      # å¯é€‰: å¯ç”¨APIå¯†é’¥ä¿æŠ¤
      # - QDRANT__SERVICE__API_KEY=${QDRANT_API_KEY}
    networks:
      - anything-llm
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:6333/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  anything-llm:
    container_name: anythingllm
    platform: linux/amd64
    image: azu12138/promptx-agenticrag:latest
    cap_add:
      - SYS_ADMIN
    volumes:
      - "./.env:/app/server/.env"
      - "../server/storage:/app/server/storage"
      - "../collector/hotdir/:/app/collector/hotdir"
      - "../collector/outputs/:/app/collector/outputs"
      - "./mcp_servers.json:/app/server/storage/plugins/anythingllm_mcp_servers.json"
      # âœ… PromptXæ•°æ®æŒä¹…åŒ– - æ•´ä¸ª.promptxç›®å½•
      - "./.promptx:/root/.promptx"
    user: "${UID:-1000}:${GID:-1000}"
    ports:
      - "3001:3001"
    env_file:
      - .env
    networks:
      - anything-llm
    extra_hosts:
      - "host.docker.internal:host-gateway"
    # âœ… ä¾èµ–QdrantæœåŠ¡å…ˆå¯åŠ¨
    depends_on:
      qdrant:
        condition: service_healthy
    restart: unless-stopped

  # âŒ åˆ é™¤ï¼šä¸å†éœ€è¦ç‹¬ç«‹çš„PromptXå®¹å™¨
  # PromptXç°åœ¨é€šè¿‡NPXåœ¨ä¸»åº”ç”¨å®¹å™¨å†…å¯åŠ¨
  # promptx:
  #   container_name: promptx
  #   image: deepracticexs/promptx:latest
  #   ports:
  #     - "5203:5203"
  #   volumes:
  #     - "./.promptx:/root/.promptx"
  #   networks:
  #     - anything-llm
  #   restart: unless-stopped
  #   environment:
  #     - NODE_ENV=production
