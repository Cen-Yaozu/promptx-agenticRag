name: anythingllm

networks:
  anything-llm:
    driver: bridge

services:
  anything-llm:
    container_name: anythingllm
    image: azu12138/promptx-agenticrag:latest
    cap_add:
      - SYS_ADMIN
    volumes:
      - "./.env:/app/server/.env"
      - "../server/storage:/app/server/storage"
      - "../collector/hotdir/:/app/collector/hotdir"
      - "../collector/outputs/:/app/collector/outputs"
      - "./mcp_servers.json:/app/server/storage/plugins/anythingllm_mcp_servers.json"
      # ✅ 新增：挂载.promptx目录到主应用容器
      - "./.promptx:/root/.promptx"
    user: "${UID:-1000}:${GID:-1000}"
    ports:
      - "3001:3001"
    env_file:
      - .env
    networks:
      - anything-llm
    extra_hosts:
      - "host.docker.internal:host-gateway"
    # ❌ 删除：不再依赖独立的promptx容器
    # depends_on:
    #   - promptx
    restart: unless-stopped

  # ❌ 删除：不再需要独立的PromptX容器
  # PromptX现在通过NPX在主应用容器内启动
  # promptx:
  #   container_name: promptx
  #   image: deepracticexs/promptx:latest
  #   ports:
  #     - "5203:5203"
  #   volumes:
  #     - "./.promptx:/root/.promptx"
  #   networks:
  #     - anything-llm
  #   restart: unless-stopped
  #   environment:
  #     - NODE_ENV=production
